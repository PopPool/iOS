name: ğŸ”§ Swiftlint Autocorrect

on:
  pull_request:
    types: [opened]
    branches: ['dev/**']

jobs:
  autocorrect:
    name: SwiftLint Autocorrect
    runs-on: macos-15
    if: github.actor != 'github-actions[bot]'  # ì»¤ë°‹ ë¬´í•œ ë£¨í”„ ë°©ì§€ë¥¼ ìœ„í•´ ë´‡ ì»¤ë°‹ì€ ë¬´ì‹œ

    steps:
      - name: ğŸ“ Checkout Repository  # ì €ì¥ì†Œ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ”¨ Set up Xcode  # Xcode 16.2 ì„ íƒ
        run: sudo xcode-select -s /Applications/Xcode_16.2.app

      - name: â¬‡ï¸ Install SwiftLint  # SwiftLint ì„¤ì¹˜
        run: brew install swiftlint

      - name: ğŸ”§ Run SwiftLint Autocorrect  # SwiftLint ìë™ ìˆ˜ì • ì‹¤í–‰
        run: swiftlint autocorrect

      - name: ğŸš€ Commit and Push Changes  # ë³€ê²½ ì‚¬í•­ ìë™ ì»¤ë°‹ ë° í‘¸ì‹œ
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          BRANCH_NAME="${GITHUB_REF_NAME}"
          if [[ "$BRANCH_NAME" =~ (#([0-9]+)) ]]; then
            ISSUE_NUMBER="${BASH_REMATCH[1]}"
          else
            ISSUE_NUMBER="#??"
          fi

          if [ -n "$(git status --porcelain)" ]; then
            git add .
            git commit -m "style/${ISSUE_NUMBER}: Apply SwiftLint autocorrect"
            git push
          else
            echo "No changes to commit"
          fi
